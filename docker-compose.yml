# Compose specification (compatible with Docker Compose and Podman)
# For Podman: podman-compose -f docker-compose.yml up -d
# For Kubernetes: podman generate kube telegram-twitter > pod.yaml
services:
  telegram-bot-api:
    image: aiogram/telegram-bot-api:latest
    container_name: telegram-bot-api
    restart: unless-stopped
    environment:
      TELEGRAM_API_ID: "${TELEGRAM_API_ID}"
      TELEGRAM_API_HASH: "${TELEGRAM_API_HASH}"
    volumes:
      - telegram-bot-api-data:/var/lib/telegram-bot-api
    ports:
      - "8081:8081"

  telegram-twitter:
    image: ghcr.io/mlshdev/telegram-twitter:latest
    container_name: telegram-twitter
    restart: unless-stopped
    depends_on:
      telegram-bot-api:
        condition: service_started
    # SELinux: use :Z for automatic relabeling (no label=disable needed)
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"
    environment:
      - BOT_TOKEN=
      - ALLOWLIST_USER_IDS=
      - YTDLP_COOKIES_FILE=/data/cookies.txt
      - YTDLP_TWITTER_API=${YTDLP_TWITTER_API-graphql}
      - YTDLP_TWITTER_API_ORDER=${YTDLP_TWITTER_API_ORDER-graphql,legacy,syndication}
      - YTDLP_USER_AGENT=
      # Local Telegram Bot API server URL (points to telegram-bot-api service)
      - TELEGRAM_LOCAL_API_URL=http://telegram-bot-api:8081
    volumes:
      - ./data:/data:Z
    labels:
      - "traefik.enable=false"
      - "io.containers.autoupdate=registry"

volumes:
  telegram-bot-api-data:
